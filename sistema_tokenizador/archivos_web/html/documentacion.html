<!--
  HTML de documentación.
  Aplicación web de sistema tokenizador.
  Proyecto Lovelace.
-->

<div
  class="seccion"
  flex="none"
  layout="column">

  <h3>Cómo utilizar la API web</h3>

  <p>
    La API permite realizar tres operaciones que se explican a continuación;
    todas las operaciones se deben realizar mediante peticiones HTTP utilizando
    el método POST. Todas las peticiones deben tener los encabezados de tipo de
    contenido (especificando que se está enviando un JSON) y el encabezado de
    autenticación básica (siguiendo el formato dado en el <a
    href="https://tools.ietf.org/html/rfc7617">RFC 7617</a>). En el cuerpo de
    la petición se especifica el método y el PAN o el método y el token.
  </p>

  <h4>Tokenización</h4>
  <p>
    Permite, a partir del número de una tarjeta, obtener un token asociado a
    él. Debe encontrarse en estado <b>aprobado</b> o <b>en cambio de llaves</b>;
    en todos los casos, la llave que se utilizará al tokenizar siempre será la
    que tenga estado <b>actual</b>.
  </p>

  <h5> Uso y ejemplo </h5>
  <p>
    En el cuerpo de la petición se debe señalar el <b>PAN</b> y el
    <b>método</b>, siguiendo el siguiente esquema:
    <code>
      POST /programa_tokenizador/tokenizar HTTP/1.1 <br />
      { <br />
        Authorization: Basic QWxhZgRpbjpPcGVuU2VYW11 <br />
        Content-Type: Application/JSON <br />
      } <br />
      { <br />
        "pan" : "28045869693113314", <br />
        "metodo" : "FFX" <br />
      }
    </code>
    <br /> Los valores para el campo método son: FFX, BPS, TKR, AHR o DRBG.
  </p>

  <h5> Errores </h5>
  <p>
    A continuación se listan los errores que pueden surgir al tokenizar un PAN.
    <dl>
      <dt><code>
          400 - El PAN recibido es inválido.
      </code></dt>
        <dd>
          El PAN enviado no es válido; para serlo debe tener una longitud de 12
          a 19 dígitos y el último dígito debe ser calculado mediante el
          algoritmo de Luhn.
        </dd>
      <dt><code>
          400 - Ya existe un token asociado, utilice la función de
          retokenización
      </code></dt>
        <dd>
          El PAN que fue enviado ya tiene un token asignado, pero se encuentra
          en cambio de llaves; retokenice este token.
        </dd>
      <dt><code>
          401 - Es necesario proveer credenciales para realizar esta operación
      </code></dt>
        <dd>
          Este error surge cuando el encabezado de autenticación no se ha
          encontrado.
        </dd>
      <dt><code>
          401 - Las credenciales son incorrectas
      </code></dt>
        <dd>
          Este error surge cuando las credenciales especificadas en el
          encabezado no se encuentran registradas en el sistema.
        </dd>
      <dt><code>
          403 - El usuario no tiene los privilegios para esta operación
      </code></dt>
        <dd>
          Aunque el usuario está registrado, no tiene los permisos necesarios
          para realizar esta operación.
        </dd>
      <dt><code>
          403 - EL usuario no se encuentra en el estado necesario para esta
          operación.
      </code></dt>
        <dd>
          Aunque el usuario está registrado, no se encuentra en el estado
          requerido (<code>aprobado</code> o <code>en cambio de llaves</code>)
          para realizar esta operación; podría aún no estar aprobado o haber
          sido rechazado o puesto en la lista negra.
        </dd>
      <dt><code>
          403 - [Token]
      </code></dt>
        <dd>
          Ya existe un token asociado al PAN que envió para tokenizar;
          por regla, solo se puede tener uno, así que se regresa el token que
          fue creado para este PAN. Si se encuentra <b>en cambio de llaves</b>,
          y el token ya fue retokenizado, regresa el más nuevo.
        </dd>
      <dt><code>
          403 - Parámetros incompletos o incorrectos
      </code></dt>
        <dd>
          El servidor no pudo encontrar el parámetro <code>pan</code>,
          <code>metodo</code> o ambos.
        </dd>
    </dl>
  </p>

  <h4>Detokenización</h4>
  <p>
    Permite, a partir de un token, obtener el PAN asociado a él.
    Debe encontrarse en estado <b>aprobado</b> o <b>en cambio de llaves</b>;
    el segundo estado se alcanza cuando se inicia el refresco de llaves desde
    el sitio web y, en caso de haberlo iniciado, es menester especificar si se
    desea detokenizar utilizando la llave <b>anterior</b> o la llave que fue
    creada al iniciar el refresco de llaves (la llave <b>actual</b>). Si no
    es especificado, se utiliza la llave <b>actual</b>.
  </p>

  <h5> Uso y ejemplo </h5>
  <p>
    En el cuerpo de la petición se debe señalar el <b>PAN</b> y el
    <b>método</b>, siguiendo el siguiente esquema:
    <code>
      POST /programa_tokenizador/detokenizar HTTP/1.1 <br />
      { <br />
        Authorization: Basic QWxhZgRpbjpPcGVuU2VYW11 <br />
        Content-Type: Application/JSON <br />
      } <br />
      { <br />
        "token" : "28045869693113314", <br />
        "metodo" : "FFX" <br />
        "versionLlave" : "anterior" <br />
      }
    </code>
    <br />Los valores para el campo método son: FFX, BPS, TKR, AHR o DRBG.
    <br />Los valores para el campo de versiónLlave son: anterior y actual.
  </p>

  <h5> Errores </h5>
  <p>
    A continuación se listan los errores que pueden surgir al detokenizar un
    token.
    <dl>
      <dt><code>
          400 - El token recibido es inválido
      </code></dt>
        <dd>
          El servidor recibió un token que no es válido o generado por este
          servicio.
        </dd>
      <dt><code>
          400 - El token no existe en la base de datos.
      </code></dt>
        <dd>
          El token, aunque válido, no se encuentra registrado y asociado con
          el cliente que envió la petición.
        </dd>
      <dt><code>
          401 - Es necesario proveer credenciales para realizar esta operación
      </code></dt>
        <dd>
          Este error surge cuando el encabezado de autenticación no se ha
          encontrado.
        </dd>
      <dt><code>
          401 - Las credenciales son incorrectas
      </code></dt>
        <dd>
          Este error surge cuando las credenciales especificadas en el
          encabezado no se encuentran registradas en el sistema.
        </dd>
      <dt><code>
          403 - El usuario no tiene los privilegios para esta operación
      </code></dt>
        <dd>
          Aunque el usuario está registrado, no tiene los permisos necesarios
          para realizar esta operación.
        </dd>
      <dt><code>
          403 - EL usuario no se encuentra en el estado necesario para esta
          operación.
      </code></dt>
        <dd>
          Aunque el usuario está registrado, no se encuentra en el estado
          requerido (<code>aprobado</code> o <code>en cambio de llaves</code>)
          para realizar esta operación; podría aún no estar aprobado o haber
          sido rechazado o puesto en la lista negra. Ingrese al sitio web para
          obtener más información sobre su estado.
        </dd>
      <dt><code>
          403 - Parámetros incompletos o incorrectos
      </code></dt>
        <dd>
          El servidor no pudo encontrar el parámetro <code>token</code>,
          <code>metodo</code> o ambos.
        </dd>
    </dl>
  </p>

  <h4>Retokenización</h4>
  <p>
    Permite, a partir de un token, obtener la nueva versión del mismo.
    Debe encontrarse en estado <b>en cambio de llaves</b> y proveer en el cuerpo
    de la petición el token que se desea actualizar; para obtener esta nueva
    versión del token, se detokenizará con la llave anterior y el resultado
    se tokenizará con la llave actual. Es menester utilizar el mismo método con
    el que fue creado el token para realizar esta operación.
  </p>

  <h5> Uso y ejemplo </h5>
  <p>
    En el cuerpo de la petición se debe señalar el <b>token</b> y el
    <b>método</b>, siguiendo el siguiente esquema:
    <code>
      POST /programa_tokenizador/retokenizar HTTP/1.1 <br />
      { <br />
        Authorization: Basic QWxhZgRpbjpPcGVuU2VYW11 <br />
        Content-Type: Application/JSON <br />
      } <br />
      { <br />
        "token" : "28045869693113314", <br />
        "metodo" : "FFX" <br />
      }
    </code>
    <br />Los valores para el campo método son: FFX, BPS, TKR, AHR o DRBG.
  </p>

  <h5> Errores </h5>
  <p>
    A continuación se listan los errores que pueden surgir al detokenizar un
    token.
    <dl>
      <dt><code>
          400 - El token recibido es inválido
      </code></dt>
        <dd>
          El servidor recibió un token que no es válido o generado por este
          servicio.
        </dd>
      <dt><code>
          400 - El token no existe en la base de datos.
      </code></dt>
        <dd>
          El token, aunque válido, no se encuentra registrado y asociado con
          el cliente que envió la petición.
        </dd>
      <dt><code>
          401 - Es necesario proveer credenciales para realizar esta operación
      </code></dt>
        <dd>
          Este error surge cuando el encabezado de autenticación no se ha
          encontrado.
        </dd>
      <dt><code>
          401 - Las credenciales son incorrectas
      </code></dt>
        <dd>
          Este error surge cuando las credenciales especificadas en el
          encabezado no se encuentran registradas en el sistema.
        </dd>
      <dt><code>
          403 - El usuario no tiene los privilegios para esta operación
      </code></dt>
        <dd>
          Aunque el usuario está registrado, no tiene los permisos necesarios
          para realizar esta operación.
        </dd>
      <dt><code>
          403 - EL usuario no se encuentra en el estado necesario para esta
          operación.
      </code></dt>
        <dd>
          Aunque el usuario está registrado, no se encuentra en el estado
          requerido (<code>en cambio de llaves</code>). Ingrese al sitio web
          para otener más información sobre su estado.
        </dd>
      <dt><code>
          403 - Parámetros incompletos o incorrectos
      </code></dt>
        <dd>
          El servidor no pudo encontrar el parámetro <code>token</code>,
          <code>metodo</code> o ambos.
        </dd>
      <dt><code>
            403 - [Token]
      </code></dt>
        <dd>
          Está intentando retokenizar un token que ya fue retokenizado. El
          servidor regresa el token creado más recientemente.
        </dd>
    </dl>
  </p>

</div>
